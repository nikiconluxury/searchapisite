<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ScrapeCompass - Login & Register</title>

  <!-- Link to External CSS -->
  <link rel="stylesheet" href="css/main.css" />

  <!-- Font Awesome for Icons -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
  />
</head>
<body>
  <!-- Navigation Bar -->
  <nav class="navbar">
    <div class="inner-container">
      <a href="index.html" class="logo">SCRAPECOMPASS</a>
      <div class="nav-links">
        <a href="index.html" class="nav-link active">Home</a>
        <a href="dashboard.html" class="nav-link">Dashboard</a>
        <a href="features.html" class="nav-link">Features</a>
        <a href="solutions.html" class="nav-link">Solutions</a>
        <a href="pricing.html" class="nav-link">Pricing</a>
        <a href="documentation.html" class="nav-link">Documentation</a>
      </div>
    </div>
  </nav>

  <!-- Alert Box -->
  <div id="alertBox" class="alert-box" style="display: none;">
    <i class="icon"></i>
    <span class="message"></span>
    <button onclick="closeAlert()" class="close-btn">&times;</button>
  </div>

  <!-- Hero Section -->
  <section class="hero">
    <div class="inner-container">
      <h1>Welcome!</h1>
      <p>Login or register to access your web scraping dashboard and manage your data extraction.</p>
    </div>
  </section>

  <!-- Login and Register Section -->
  <section id="auth-section">
    <div class="container">
      <!-- Login Form -->
      <div id="login-form" class="auth-form">
        <h2 class="section-title">Login</h2>
        <form onsubmit="loginUser(event)">
          <label for="login-username">Username</label>
          <input
            type="text"
            id="login-username"
            name="username"
            placeholder="Enter your username"
            required
          />
          <label for="login-password">Password</label>
          <input
            type="password"
            id="login-password"
            name="password"
            placeholder="Enter your password"
            required
          />
          <button type="submit" class="primary-btn">Login</button>
        </form>
        <p>
          Don't have an account? <a href="#" onclick="toggleToRegister()">Register here</a>.
        </p>
      </div>

      <!-- Register Form -->
      <div id="register-form" class="auth-form" style="display: none;">
        <h2 class="section-title">Register</h2>
        <form onsubmit="registerUser(event)">
          <label for="register-username">Username</label>
          <input
            type="text"
            id="register-username"
            name="username"
            placeholder="Create a username"
            required
          />
          <label for="register-password">Password</label>
          <input
            type="password"
            id="register-password"
            name="password"
            placeholder="Create a password"
            required
          />
          <button type="submit" class="primary-btn">Register</button>
        </form>
        <p>
          Already have an account? <a href="#" onclick="toggleToLogin()">Login here</a>.
        </p>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="footer-container">
      <div class="footer-section">
        <h4>Company</h4>
        <ul>
          <li><a href="about.html">About Us</a></li>
          <li><a href="contact.html">Contact</a></li>
          <li><a href="terms.html">Terms & Conditions</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Resources</h4>
        <ul>
          <li><a href="documentation.html">Documentation</a></li>
          <li><a href="pricing.html">Pricing</a></li>
          <li><a href="faq.html">FAQs</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Contact</h4>
        <p>Email: <a href="mailto:support@scrapecompass.com">support@scrapecompass.com</a></p>
        <p>Phone: +1 (555) 123-4567</p>
      </div>
    </div>
  </footer>

  <!-- Script Section -->
  <script>
    // Show Alert
    function showAlert(status, message) {
      const alertBox = document.getElementById("alertBox");
      const icon = alertBox.querySelector(".icon");
      const messageSpan = alertBox.querySelector(".message");

      messageSpan.innerText = message;

      alertBox.className = `alert-box ${status}`;
      icon.className = status === "success" ? "icon fas fa-check-circle" : "icon fas fa-exclamation-circle";
      alertBox.style.display = "flex";

      setTimeout(() => {
        alertBox.style.display = "none";
      }, 5000);
    }

    // Close Alert
    function closeAlert() {
      document.getElementById("alertBox").style.display = "none";
    }

    // Toggle Between Login and Register
    function toggleToLogin() {
      document.getElementById("login-form").style.display = "block";
      document.getElementById("register-form").style.display = "none";
    }

    function toggleToRegister() {
      document.getElementById("login-form").style.display = "none";
      document.getElementById("register-form").style.display = "block";
    }

    // Login Function
    async function loginUser(event) {
      event.preventDefault();
      const username = document.getElementById("login-username").value;
      const password = document.getElementById("login-password").value;

      try {
        const response = await fetch(`${API_URL}/token`, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({ username, password }),
        });

        if (response.ok) {
          const data = await response.json();
          localStorage.setItem("access_token", data.access_token);
          showAlert("success", "Login successful! Redirecting...");
          setTimeout(() => window.location.href = "dashboard.html", 2000);
        } else {
          throw new Error("Invalid username or password");
        }
      } catch (error) {
        showAlert("error", error.message);
      }
    }

    // Register Function
    async function registerUser(event) {
      event.preventDefault();
      const username = document.getElementById("register-username").value;
      const password = document.getElementById("register-password").value;

      try {
        const response = await fetch(`${API_URL}/register`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password }),
        });

        if (response.ok) {
          showAlert("success", "Registration successful! Redirecting to login...");
          setTimeout(toggleToLogin, 2000);
        } else {
          const errorData = await response.json();
          throw new Error(errorData.detail || "Registration failed");
        }
      } catch (error) {
        showAlert("error", error.message);
      }
    }
  </script>


  <!-- Script Section -->
  <script>


    // Show Alert
    function showAlert(status, message) {
      const alertBox = document.getElementById("alertBox");
      const icon = alertBox.querySelector(".icon");
      const messageSpan = alertBox.querySelector(".message");

      messageSpan.innerText = message;

      alertBox.className = `alert-box ${status}`;
      icon.className = status === "success" ? "icon fas fa-check-circle" : "icon fas fa-exclamation-circle";
      alertBox.style.display = "flex";

      setTimeout(() => {
        alertBox.style.display = "none";
      }, 5000);
    }

    // Close Alert
    function closeAlert() {
      document.getElementById("alertBox").style.display = "none";
    }

    // Toggle Between Login and Register
    function toggleToLogin() {
      document.getElementById("login-form").style.display = "block";
      document.getElementById("register-form").style.display = "none";
    }

    function toggleToRegister() {
      document.getElementById("login-form").style.display = "none";
      document.getElementById("register-form").style.display = "block";
    }
    const API_URL = "https://solid-doodle-wrrrg7gqj56x259pj-8000.app.github.dev";
    // Login Function
    async function loginUser(event) {
      event.preventDefault();
      const username = document.getElementById("login-username").value;
      const password = document.getElementById("login-password").value;

      try {
        const response = await fetch(`${API_URL}/token`, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({ username, password }),
        });

        if (response.ok) {
          const data = await response.json();
          localStorage.setItem("access_token", data.access_token);
          showAlert("success", "Login successful! Redirecting...");
          setTimeout(() => window.location.href = "dashboard.html", 2000);
        } else {
          throw new Error("Invalid username or password");
        }
      } catch (error) {
        showAlert("error", error.message);
      }
    }

    // Register Function
    async function registerUser(event) {
      event.preventDefault();
      const username = document.getElementById("register-username").value;
      const password = document.getElementById("register-password").value;

      try {
        const response = await fetch(`${API_URL}/register`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password }),
        });

        if (response.ok) {
          showAlert("success", "Registration successful! Redirecting to login...");
          setTimeout(toggleToLogin, 2000);
        } else {
          const errorData = await response.json();
          throw new Error(errorData.detail || "Registration failed");
        }
      } catch (error) {
        showAlert("error", error.message);
      }
    }
  </script>
</body>
</html>
